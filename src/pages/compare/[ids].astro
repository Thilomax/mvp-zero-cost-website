---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdsPlaceholder from '../../components/AdsPlaceholder.astro';
import cards from '../../data/cards.json';

const presetPairs = [
  ['bank-norwegian-visa', 'tf-bank-mastercard'],
  ['morrow-bank-mastercard', 'instapay-mastercard'],
  ['eco-green-card', 'cashback-pro-card'],
  ['student-start-mastercard', 'young-saver-visa'],
  ['premium-travel-visa', 'all-round-visa']
];

export function getStaticPaths() {
  return presetPairs.map(([a, b]) => ({
    params: { ids: `${a}-vs-${b}` }
  }));
}

const { ids } = Astro.params;
// Expect slug format "card1-vs-card2"
const parts = ids.split('-vs-');
if (parts.length !== 2) {
  throw new Error(`Invalid comparison slug: ${ids}`);
}
const cardA = cards.find((c) => c.id === parts[0]);
const cardB = cards.find((c) => c.id === parts[1]);
if (!cardA || !cardB) {
  throw new Error('One or both cards not found');
}
---
<BaseLayout title={`${cardA.name} vs ${cardB.name}`} description={`Compare ${cardA.name} and ${cardB.name} side by side to choose the best card for your needs.`} canonical={`https://example.pages.dev/compare/${ids}`}>
  <section class="max-w-5xl mx-auto px-4 py-12">
    <h1 class="text-3xl font-bold mb-6">{cardA.name} vs {cardB.name}</h1>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm mb-8">
        <thead>
          <tr>
            <th class="p-2">Feature</th>
            <th class="p-2 bg-neutral-light">{cardA.name}</th>
            <th class="p-2 bg-neutral-light">{cardB.name}</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b">
            <th class="p-2 text-left">Annual fee</th>
            <td class="p-2">{cardA.annual_fee === 0 ? '0 kr' : `${cardA.annual_fee} kr`}</td>
            <td class="p-2">{cardB.annual_fee === 0 ? '0 kr' : `${cardB.annual_fee} kr`}</td>
          </tr>
          <tr class="border-b">
            <th class="p-2 text-left">Interest rate</th>
            <td class="p-2">{cardA.interest_rate}%</td>
            <td class="p-2">{cardB.interest_rate}%</td>
          </tr>
          <tr class="border-b">
            <th class="p-2 text-left">Rewards</th>
            <td class="p-2">{cardA.rewards}</td>
            <td class="p-2">{cardB.rewards}</td>
          </tr>
          <tr class="border-b">
            <th class="p-2 text-left">Insurance</th>
            <td class="p-2">{cardA.insurance ? 'Yes' : 'No'}</td>
            <td class="p-2">{cardB.insurance ? 'Yes' : 'No'}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="p-4 bg-white rounded shadow">
        <h2 class="font-semibold mb-2">{cardA.name}</h2>
        <p class="mb-2 text-sm">{cardA.description}</p>
        <a href={cardA.affiliate_url} class="inline-block px-4 py-2 bg-accent text-white rounded hover:bg-accent-dark" rel="nofollow noopener" target="_blank" data-affiliate="true">Apply {cardA.name}</a>
      </div>
      <div class="p-4 bg-white rounded shadow">
        <h2 class="font-semibold mb-2">{cardB.name}</h2>
        <p class="mb-2 text-sm">{cardB.description}</p>
        <a href={cardB.affiliate_url} class="inline-block px-4 py-2 bg-accent text-white rounded hover:bg-accent-dark" rel="nofollow noopener" target="_blank" data-affiliate="true">Apply {cardB.name}</a>
      </div>
    </div>
    <p class="text-xs text-neutral-dark mt-4">Disclosure: We may earn a commission if you apply for these cards via our links.</p>
  </section>
  <AdsPlaceholder />
</BaseLayout>