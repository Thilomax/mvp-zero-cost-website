---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdsPlaceholder from '../../components/AdsPlaceholder.astro';
import cards from '../../data/cards.json';

// Pre-generate a handful of comparison pages (add more pairs anytime)
const presetPairs = [
  ['bank-norwegian-visa', 'tf-bank-mastercard'],
  ['morrow-bank-mastercard', 'instapay-mastercard'],
  ['eco-green-card', 'cashback-pro-card'],
  ['student-start-mastercard', 'young-saver-visa'],
  ['premium-travel-visa', 'all-round-visa'],
];

export function getStaticPaths() {
  return presetPairs.map(([a, b]) => ({
    params: { ids: `${a}-vs-${b}` },
  }));
}

const { ids } = Astro.params;
const parts = ids.split('-vs-');
if (parts.length !== 2) {
  throw new Error(`Invalid comparison slug: ${ids}`);
}
const [aId, bId] = parts;
const a = cards.find((c) => c.id === aId);
const b = cards.find((c) => c.id === bId);
if (!a || !b) {
  throw new Error(`One or both cards not found: ${aId}, ${bId}`);
}
---

<BaseLayout title={`Compare ${a.name} vs ${b.name}`} description={`Side-by-side comparison of ${a.name} and ${b.name} for Norway.`}>
  <section class="max-w-5xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">Compare: {a.name} vs {b.name}</h1>

    <div class="overflow-x-auto bg-white rounded shadow">
      <table class="w-full text-left">
        <thead>
          <tr class="bg-neutral-light">
            <th class="p-3">Feature</th>
            <th class="p-3">{a.name}</th>
            <th class="p-3">{b.name}</th>
          </tr>
        </thead>
        <tbody>
          <tr><td class="p-3 font-medium">Issuer</td><td class="p-3">{a.issuer}</td><td class="p-3">{b.issuer}</td></tr>
          <tr><td class="p-3 font-medium">Annual fee</td><td class="p-3">{a.annual_fee === 0 ? '0 NOK' : `${a.annual_fee} NOK`}</td><td class="p-3">{b.annual_fee === 0 ? '0 NOK' : `${b.annual_fee} NOK`}</td></tr>
          <tr><td class="p-3 font-medium">Interest</td><td class="p-3">{a.interest_rate}%</td><td class="p-3">{b.interest_rate}%</td></tr>
          <tr><td class="p-3 font-medium">Rewards</td><td class="p-3">{a.rewards}</td><td class="p-3">{b.rewards}</td></tr>
          <tr><td class="p-3 font-medium">Travel insurance</td><td class="p-3">{a.insurance ? 'Yes' : 'No'}</td><td class="p-3">{b.insurance ? 'Yes' : 'No'}</td></tr>
        </tbody>
      </table>
    </div>

    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
      <a href={a.affiliate_url} rel="nofollow sponsored" class="block bg-accent text-white px-4 py-2 rounded text-center">Apply for {a.name}</a>
      <a href={b.affiliate_url} rel="nofollow sponsored" class="block bg-accent text-white px-4 py-2 rounded text-center">Apply for {b.name}</a>
    </div>

    <div class="mt-8">
      <AdsPlaceholder />
    </div>
  </section>
</BaseLayout>
